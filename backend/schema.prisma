// backend/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Enumerações para substituir strings fixas e garantir consistência
enum Role {
  ADMIN
  CLIENTE
  COLABORADOR
}

enum Status {
  ATIVO
  INATIVO
  PENDENTE
  BLOQUEADO
}

// Modelo de Usuário (Substitui Firebase Auth + Users Collection)
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String   // Senha criptografada (bcrypt)
  name      String
  role      Role     @default(CLIENTE)
  avatarUrl String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamentos
  companyId Int?
  company   Company? @relation(fields: [companyId], references: [id])
  tasks     Task[]
  logs      Log[]
}

// Modelo de Empresa (Clientes do CRM)
model Company {
  id          Int      @id @default(autoincrement())
  name        String
  cnpj        String?  @unique
  email       String?
  phone       String?
  status      Status   @default(ATIVO)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relacionamentos
  planId      Int?
  plan        Plan?    @relation(fields: [planId], references: [id])
  users       User[]
  contacts    Contact[]
  proposals   Proposal[]
  campaigns   Campaign[]
}

// Planos de Assinatura
model Plan {
  id          Int       @id @default(autoincrement())
  name        String
  price       Decimal   @db.Decimal(10, 2)
  maxUsers    Int
  maxStorage  Int       // Em MB
  features    Json?     // Lista de funcionalidades permitidas
  companies   Company[]
}

// Contatos/Leads
model Contact {
  id        Int      @id @default(autoincrement())
  name      String
  email     String?
  phone     String
  tags      String?  // Pode ser separado em tabela se quiser normalizar
  companyId Int
  company   Company  @relation(fields: [companyId], references: [id])
}

// Propostas Comerciais
model Proposal {
  id          Int      @id @default(autoincrement())
  title       String
  value       Decimal  @db.Decimal(12, 2)
  status      String   // Ex: 'Enviada', 'Aprovada', 'Recusada'
  content     String   @db.Text // Conteúdo HTML ou JSON da proposta
  companyId   Int
  company     Company  @relation(fields: [companyId], references: [id])
  createdAt   DateTime @default(now())
}

// Tarefas (Kanban/Lista)
model Task {
  id          Int       @id @default(autoincrement())
  title       String
  description String?   @db.Text
  status      String    // 'A Fazer', 'Em Progresso', 'Feito'
  dueDate     DateTime?
  priority    String    @default("Média")
  
  userId      Int
  user        User      @relation(fields: [userId], references: [id])
  
  createdAt   DateTime  @default(now())
}

// Campanhas de Marketing/WhatsApp
model Campaign {
  id        Int      @id @default(autoincrement())
  name      String
  type      String   // 'WhatsApp', 'Email'
  status    String   // 'Agendada', 'Enviada'
  companyId Int
  company   Company  @relation(fields: [companyId], references: [id])
  sentAt    DateTime?
}

// Logs do Sistema (Auditoria)
model Log {
  id        Int      @id @default(autoincrement())
  action    String
  details   String?
  ipAddress String?
  userId    Int?
  user      User?    @relation(fields: [userId], references: [id])
  timestamp DateTime @default(now())
}